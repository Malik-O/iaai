# نظام متكامل للمراسلات والسكرابر

هذا المشروع هو واجهة برمجة تطبيقات متكاملة (API) تجمع بين وظائف روبوت WhatsApp ونظام استخراج البيانات من المواقع (Scraper).

## المميزات

### خدمة روبوت WhatsApp

-   مصادقة وإنشاء رمز QR للاتصال بـ WhatsApp
-   إرسال واستقبال رسائل النصوص، الصور، الملفات، الملصقات
-   الحصول على قائمة المحادثات ورسائل المحادثة

### خدمة استخراج البيانات (Scraper)

-   استخراج بيانات السيارات من موقع IAAI
-   استخراج تفاصيل المركبات المحددة
-   واجهة برمجة تطبيقات RESTful سهلة الاستخدام

## البدء السريع

### المتطلبات

-   Node.js v14 أو أحدث
-   NPM v6 أو أحدث

### التثبيت

1. قم بتنزيل المشروع:

```bash
git clone <repository-url>
cd <project-folder>
```

2. قم بتثبيت التبعيات:

```bash
npm install
```

3. تشغيل الخادم:

```bash
npm start
```

## استخدام واجهة برمجة التطبيقات (API)

عند تشغيل الخادم، سيكون متاحًا على المنفذ 3000 بشكل افتراضي: `http://localhost:3000`

### نقاط النهاية لروبوت WhatsApp

#### المصادقة والاتصال

-   **تهيئة الروبوت**: `POST /auth/init`
    -   يبدأ عملية الاتصال وينشئ رمز QR للمسح
-   **الحصول على رمز QR**: `GET /auth/qrcode`
    -   يعيد رمز QR كـ JSON أو صورة
-   **صورة رمز QR المباشرة**: `GET /auth/qrcode.png`
    -   يعيد رمز QR كصورة PNG
-   **حالة الاتصال**: `GET /auth/status`
    -   يعيد حالة اتصال روبوت WhatsApp
-   **تسجيل الخروج**: `POST /auth/logout`
    -   يغلق الجلسة الحالية

#### الرسائل

-   **إرسال رسائل**: `POST /messages/send`
    -   يرسل رسائل متنوعة (نص، صور، ملفات، موقع)
-   **الحصول على المحادثات**: `GET /messages/chats`
    -   يعيد قائمة بجميع المحادثات
-   **الحصول على رسائل محادثة**: `GET /messages/messages/:chatId`
    -   يعيد جميع الرسائل في محادثة محددة

### نقاط النهاية لخدمة استخراج البيانات

-   **استخراج بيانات البحث**: `GET /scrape/iaai`
    -   يستخرج نتائج البحث من IAAI
-   **استخراج تفاصيل المركبة**: `GET /scrape/vehicle/:id`
    -   يستخرج تفاصيل مركبة محددة من IAAI حسب المعرّف (ID)

## أمثلة للاستخدام

### اتصال WhatsApp

1. إرسال طلب إلى `POST /auth/init`
2. مسح رمز QR الناتج باستخدام تطبيق WhatsApp
3. انتظر الاتصال والتأكد من حالة الاتصال عبر `GET /auth/status`

### إرسال رسالة نصية

```javascript
fetch("http://localhost:3000/messages/send", {
	method: "POST",
	headers: { "Content-Type": "application/json" },
	body: JSON.stringify({
		to: "971XXXXXXXXX@c.us",
		messages: [{ type: "text", body: "مرحبا بالعالم!" }],
	}),
});
```

### استخراج بيانات السيارات

```javascript
fetch("http://localhost:3000/scrape/iaai")
	.then((response) => response.json())
	.then((data) => console.log(data));
```

### استخراج تفاصيل مركبة محددة

```javascript
fetch("http://localhost:3000/scrape/vehicle/123456~US")
	.then((response) => response.json())
	.then((data) => console.log(data));
```

## ملاحظات هامة

-   تأكد من أن لديك اتصال إنترنت مستقر عند استخدام أي من الخدمتين
-   قد تختلف نتائج السكرابر مع مرور الوقت نظرًا لتغييرات في موقع IAAI
-   تحتاج إلى مسح رمز QR من جديد إذا أعدت تشغيل الخادم
